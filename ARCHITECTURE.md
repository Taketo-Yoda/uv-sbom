# Architecture Documentation

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€uv-sbomãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è©³ç´°ã«èª¬æ˜ã—ã¾ã™ã€‚

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“åƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLI Layer                           â”‚
â”‚  (cli.rs - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®ãƒ‘ãƒ¼ã‚¹)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Layer                        â”‚
â”‚  (main.rs - ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)                  â”‚
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚              â”‚              â”‚              â”‚
  â”‚              â”‚              â”‚              â”‚
â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Lockfile  â”‚ â”‚License     â”‚ â”‚CycloneDX â”‚ â”‚Markdown        â”‚
â”‚Parser    â”‚ â”‚Fetcher     â”‚ â”‚Generator â”‚ â”‚Generator       â”‚
â”‚          â”‚ â”‚            â”‚ â”‚          â”‚ â”‚                â”‚
â”‚lockfile  â”‚ â”‚license.rs  â”‚ â”‚cyclonedx â”‚ â”‚markdown.rs     â”‚
â”‚.rs       â”‚ â”‚            â”‚ â”‚.rs       â”‚ â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       External Services             â”‚
â”‚   (PyPI JSON API)                   â”‚
â”‚   https://pypi.org/pypi/{pkg}/json  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

#### 1. CLI Layer (cli.rs)
**è²¬å‹™**: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®å®šç¾©ã¨ãƒ‘ãƒ¼ã‚¹

**å…¥åŠ›**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ å¼•æ•° (argv)
**å‡ºåŠ›**: `Args`æ§‹é€ ä½“

**ä¾å­˜é–¢ä¿‚**:
- `clap` (deriveæ©Ÿèƒ½)

#### 2. Application Layer (main.rs)
**è²¬å‹™**:
- å…¨ä½“ã®ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

**ä¸»è¦ãªé–¢æ•°**:
- `main()`: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
- `run()`: ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
- `validate_project_path()`: ãƒ‘ã‚¹æ¤œè¨¼

#### 3. Data Layer
å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»å¤‰æ›ã‚’æ‹…å½“:

**lockfile.rs**: uv.lock â†’ `Vec<Package>`
**license.rs**: `Vec<Package>` â†’ `Vec<Package>` (ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ä»˜ã)
**cyclonedx.rs**: `Vec<Package>` â†’ CycloneDX JSON
**markdown.rs**: `Vec<Package>` â†’ Markdownè¡¨

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
User Input (CLI args)
    â†“
Args {format, path, output}
    â†“
uv.lock file (TOML)
    â†“
Vec<Package> {name, version}
    â†“
PyPI API calls (HTTP)
    â†“
Vec<Package> {name, version, license, description}
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚              â”‚
CycloneDX     Markdown      (Output Format)
JSON          Table
â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚                 â”‚
stdout            File              (Output Destination)
```

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ

### lockfile.rs

**ç›®çš„**: uv.lockãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:
```rust
// å†…éƒ¨ç”¨ (TOMLãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º)
struct UvLock {
    package: Vec<UvPackage>,
}

struct UvPackage {
    name: String,
    version: String,
    source: Option<UvSource>,
}

// å…¬é–‹ç”¨
pub struct Package {
    pub name: String,
    pub version: String,
    pub description: Option<String>,  // å¾Œã§è¨­å®š
    pub license: Option<String>,      // å¾Œã§è¨­å®š
}
```

**ä¸»è¦ãªé–¢æ•°**:
```rust
pub fn parse_lockfile(content: &str) -> Result<Vec<Package>>
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
- TOML ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ â†’ `anyhow::Context`ã§è©³ç´°ã‚’è¿½åŠ 

**ãƒ†ã‚¹ãƒˆ**:
- æœ‰åŠ¹ãªuv.lockã®ãƒ‘ãƒ¼ã‚¹
- è¤‡æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‡¦ç†
- ä¾å­˜é–¢ä¿‚æƒ…å ±ã®ç„¡è¦– (ç¾åœ¨ã¯ä½¿ç”¨ã—ãªã„)

### license.rs

**ç›®çš„**: PyPI APIã‹ã‚‰ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ã¨èª¬æ˜ã‚’å–å¾—

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:
```rust
// PyPI APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ (å†…éƒ¨ç”¨)
struct PyPiPackageInfo {
    info: PyPiInfo,
}

struct PyPiInfo {
    license: Option<String>,
    summary: Option<String>,
    classifiers: Vec<String>,
}
```

**ä¸»è¦ãªé–¢æ•°**:
```rust
pub fn fetch_licenses(packages: Vec<Package>) -> Result<Vec<Package>>
fn fetch_from_pypi_with_retry(...) -> Result<(Option<String>, Option<String>)>
fn fetch_from_pypi(...) -> Result<(Option<String>, Option<String>)>
fn extract_license_from_classifiers(classifiers: &[String]) -> Option<String>
```

**ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥**:
```rust
const MAX_RETRIES: u32 = 3;
// ç·šå½¢ãƒãƒƒã‚¯ã‚ªãƒ•: 100ms, 200ms, 300ms
Duration::from_millis(100 * attempt as u64)
```

**ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º**:
```rust
eprint!("\r   é€²æ—: {}/{} ({:.1}%) - {}", current, total, percentage, name);
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
- HTTP ã‚¨ãƒ©ãƒ¼ â†’ ãƒ­ã‚°å‡ºåŠ›ã€å‡¦ç†ç¶™ç¶š
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ â†’ ãƒªãƒˆãƒ©ã‚¤
- JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ â†’ ãƒ­ã‚°å‡ºåŠ›ã€å‡¦ç†ç¶™ç¶š

**ãƒ†ã‚¹ãƒˆ**:
- Classifier ã‹ã‚‰ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æŠ½å‡º
- ç©ºã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ã®å‡¦ç†
- "UNKNOWN"ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®é™¤å¤–

### cyclonedx.rs

**ç›®çš„**: CycloneDX 1.6 ä»•æ§˜ã®SBOMç”Ÿæˆ

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:
```rust
pub struct Bom {
    bom_format: String,      // "CycloneDX"
    spec_version: String,    // "1.6"
    version: u32,            // 1
    serial_number: String,   // UUID
    metadata: Metadata,
    components: Vec<Component>,
}

struct Metadata {
    timestamp: String,       // RFC3339å½¢å¼
    tools: Vec<Tool>,
}

struct Component {
    component_type: String,  // "library"
    name: String,
    version: String,
    description: Option<String>,
    licenses: Option<Vec<License>>,
    purl: String,            // Package URL
}
```

**PURLå½¢å¼**:
```
pkg:pypi/{package_name}@{version}
```

**ä¸»è¦ãªé–¢æ•°**:
```rust
pub fn generate_bom(packages: Vec<Package>) -> Result<Bom>
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
- UUIDç”Ÿæˆå¤±æ•— (é€šå¸¸ç™ºç”Ÿã—ãªã„)
- JSON ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¤±æ•—

**ãƒ†ã‚¹ãƒˆ**:
- BOMç”Ÿæˆã®åŸºæœ¬æ©Ÿèƒ½
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§
- PURLå½¢å¼ã®æ¤œè¨¼

### markdown.rs

**ç›®çš„**: Markdownè¡¨å½¢å¼ã®SBOMç”Ÿæˆ

**å‡ºåŠ›å½¢å¼**:
```markdown
# Software Bill of Materials (SBOM)

| Package | Version | License | Description |
|---------|---------|---------|-------------|
| ... | ... | ... | ... |
```

**ä¸»è¦ãªé–¢æ•°**:
```rust
pub fn generate_table(packages: Vec<Package>) -> String
```

**ç‰¹æ®Šæ–‡å­—å‡¦ç†**:
- `|` â†’ `\|` (ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—)
- `\n` â†’ ` ` (ã‚¹ãƒšãƒ¼ã‚¹ã«ç½®æ›)

**ãƒ†ã‚¹ãƒˆ**:
- åŸºæœ¬çš„ãªè¡¨ç”Ÿæˆ
- ãƒ‘ã‚¤ãƒ—æ–‡å­—ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- æ”¹è¡Œã®å‡¦ç†

### error.rs

**ç›®çš„**: ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å‹ã®å®šç¾©

**ã‚¨ãƒ©ãƒ¼å‹**:
```rust
pub enum SbomError {
    LockfileNotFound { path, suggestion },
    LockfileParseError { path, details },
    LicenseFetchError { package_name, details },
    OutputGenerationError { format, details },
    FileWriteError { path, details },
    InvalidProjectPath { path, reason },
}
```

**Displayå®Ÿè£…ã®ç‰¹å¾´**:
- æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ğŸ’¡ ãƒãƒ¼ã‚¯ã§è§£æ±ºç­–ã‚’æç¤º
- ãƒ‘ã‚¹æƒ…å ±ã‚’æ˜ç¤º
- è©³ç´°æƒ…å ±ã‚’å«ã‚ã‚‹

**anyhowçµ±åˆ**:
```rust
impl From<SbomError> for anyhow::Error {
    fn from(err: SbomError) -> Self {
        anyhow::anyhow!(err)
    }
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### ã‚¨ãƒ©ãƒ¼ä¼æ’­

```
Low Level (å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«)
    â†“ Result<T, anyhow::Error>
    â†“ .context("è©³ç´°æƒ…å ±")
    â†“
Mid Level (main.rs ã® run())
    â†“ Result<(), anyhow::Error>
    â†“ SbomError::* ã«å¤‰æ›
    â†“
High Level (main.rs ã® main())
    â†“ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    â†“ ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒ¼ãƒ³è¡¨ç¤º
    â†“
process::exit(1)
```

### ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**æ–¹é‡**: éƒ¨åˆ†çš„ãªå¤±æ•—ã‚’è¨±å®¹

**ä¾‹**: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±å–å¾—
```rust
match fetch_from_pypi_with_retry(...) {
    Ok((license, summary)) => {
        // æˆåŠŸ: æƒ…å ±ã‚’è¨­å®š
        package.license = license;
        package.description = summary;
    }
    Err(e) => {
        // å¤±æ•—: è­¦å‘Šã‚’è¡¨ç¤ºã—ã¦ç¶™ç¶š
        eprintln!("âš ï¸  è­¦å‘Š: {}ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±å–å¾—ã«å¤±æ•—", name);
        // ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯å«ã‚ã‚‹ (ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ãªã—)
    }
}
```

## ä¾å­˜é–¢ä¿‚ç®¡ç†

### ç›´æ¥ä¾å­˜é–¢ä¿‚

```toml
[dependencies]
clap = "4.5"          # CLI - deriveæ©Ÿèƒ½ä½¿ç”¨
serde = "1.0"         # ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ - deriveæ©Ÿèƒ½ä½¿ç”¨
serde_json = "1.0"    # JSONå‡¦ç†
toml = "0.8"          # TOML (uv.lock) ãƒ‘ãƒ¼ã‚¹
anyhow = "1.0"        # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
reqwest = "0.12"      # HTTP - blockingæ©Ÿèƒ½ä½¿ç”¨
chrono = "0.4"        # æ—¥æ™‚å‡¦ç† - serdeæ©Ÿèƒ½ä½¿ç”¨
uuid = "1.10"         # UUIDç”Ÿæˆ - v4, serdeæ©Ÿèƒ½ä½¿ç”¨
```

### æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã®ä½¿ç”¨

- `clap`: `derive` - æ§‹é€ ä½“ã‹ã‚‰CLIå®šç¾©ã‚’ç”Ÿæˆ
- `serde`: `derive` - æ§‹é€ ä½“ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- `reqwest`: `json`, `blocking` - åŒæœŸHTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `chrono`: `serde` - æ—¥æ™‚ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- `uuid`: `v4`, `serde` - UUIDv4ç”Ÿæˆã¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

### ä¾å­˜é–¢ä¿‚ã‚°ãƒ©ãƒ•

```
main.rs
â”œâ”€â”€ clap (CLI)
â”œâ”€â”€ anyhow (ã‚¨ãƒ©ãƒ¼)
â””â”€â”€ å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    â”œâ”€â”€ lockfile.rs
    â”‚   â”œâ”€â”€ serde
    â”‚   â””â”€â”€ toml
    â”œâ”€â”€ license.rs
    â”‚   â”œâ”€â”€ serde
    â”‚   â””â”€â”€ reqwest
    â”œâ”€â”€ cyclonedx.rs
    â”‚   â”œâ”€â”€ serde
    â”‚   â”œâ”€â”€ serde_json
    â”‚   â”œâ”€â”€ chrono
    â”‚   â””â”€â”€ uuid
    â”œâ”€â”€ markdown.rs (ä¾å­˜ãªã—)
    â””â”€â”€ error.rs (std ã®ã¿)
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§

### æ™‚é–“è¨ˆç®—é‡

- **uv.lockãƒ‘ãƒ¼ã‚¹**: O(n) - nã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•°
- **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±å–å¾—**: O(n) - nã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•°ã€å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- **å‡ºåŠ›ç”Ÿæˆ**: O(n) - nã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•°

### ç©ºé–“è¨ˆç®—é‡

- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨**: O(n) - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±ã‚’ä¿æŒ
- **ä¸€æ™‚çš„ãªãƒ¡ãƒ¢ãƒª**: HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã”ã¨)

### ãƒœãƒˆãƒ«ãƒãƒƒã‚¯

1. **PyPI APIå‘¼ã³å‡ºã—** (æœ€å¤§)
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·: ~100-500ms/ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
   - é€æ¬¡å‡¦ç†: n Ã— ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·

2. **TOML ãƒ‘ãƒ¼ã‚¹** (å°)
   - ãƒ•ã‚¡ã‚¤ãƒ«I/O: ~10ms
   - ãƒ‘ãƒ¼ã‚¹: ~50ms

3. **JSONç”Ÿæˆ** (å°)
   - ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º: ~10ms

### æœ€é©åŒ–ã®å¯èƒ½æ€§

**ä¸¦åˆ—å‡¦ç†**:
```rust
// ç¾åœ¨ (é€æ¬¡å‡¦ç†)
for package in packages {
    fetch_license(package);  // ~200ms
}
// åˆè¨ˆ: n Ã— 200ms

// ä¸¦åˆ—å‡¦ç†
tokio::spawn ã§ä¸¦åˆ—åŒ–
// åˆè¨ˆ: ~200ms (ä¸¦åˆ—åº¦ã«ã‚ˆã£ã¦)
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥**:
```rust
// PyPI APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ™‚: ~1ms
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹æ™‚: ~200ms + ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### è„…å¨ãƒ¢ãƒ‡ãƒ«

**æƒ³å®šã™ã‚‹è„…å¨**:
1. ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒ
2. PyPI APIã®å½è£…
3. æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©

**å¯¾ç­–**:
1. ãƒ‘ã‚¹æ¤œè¨¼ (`validate_project_path`)
2. HTTPSé€šä¿¡ (reqwestã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ¶å¾¡

### å…¥åŠ›æ¤œè¨¼

```rust
fn validate_project_path(path: &Path) -> Result<()> {
    // å­˜åœ¨ç¢ºèª
    if !path.exists() {
        return Err(...);
    }

    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
    if !path.is_dir() {
        return Err(...);
    }

    // ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã®è¿½è·¡ (æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå‡¦ç†)
    Ok(())
}
```

### å¤–éƒ¨é€šä¿¡

**PyPI API**:
- ãƒ—ãƒ­ãƒˆã‚³ãƒ«: HTTPS (TLS 1.2ä»¥ä¸Š)
- èªè¨¼: ä¸è¦
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 10ç§’
- User-Agent: `uv-sbom/0.1.0`

**ãƒªãƒˆãƒ©ã‚¤**:
- æœ€å¤§å›æ•°: 3å›
- ãƒãƒƒã‚¯ã‚ªãƒ•: ç·šå½¢ (100ms, 200ms, 300ms)

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«é…ç½®:
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_xxx() {
        // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
    }
}
```

### ãƒ†ã‚¹ãƒˆã®ã‚«ãƒãƒ¬ãƒƒã‚¸

- **lockfile.rs**: ãƒ‘ãƒ¼ã‚¹æˆåŠŸã€è¤‡æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- **license.rs**: ClassifieræŠ½å‡ºã€UNKNOWNãƒ©ã‚¤ã‚»ãƒ³ã‚¹
- **cyclonedx.rs**: BOMç”Ÿæˆã€PURLå½¢å¼
- **markdown.rs**: è¡¨ç”Ÿæˆã€ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†

### E2Eãƒ†ã‚¹ãƒˆ

**ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** (`examples/sample-project`):
```bash
cargo run -- --path examples/sample-project --format json
cargo run -- --path examples/sample-project --format markdown
```

## æ‹¡å¼µæ€§

### æ–°ã—ã„å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è¿½åŠ 

1. **æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ** (ä¾‹: `spdx.rs`)
2. **OutputFormatåˆ—æŒ™å‹ã«è¿½åŠ **
3. **main.rsã«ãƒãƒƒãƒãƒ³ã‚°è¿½åŠ **
4. **ãƒ†ã‚¹ãƒˆè¿½åŠ **
5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**

### æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®è¿½åŠ 

1. **æ–°ã—ã„ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ**
2. **`Package`æ§‹é€ ä½“ã¸ã®å¤‰æ›å®Ÿè£…**
3. **CLIå¼•æ•°ã§é¸æŠå¯èƒ½ã«**
4. **ãƒ†ã‚¹ãƒˆè¿½åŠ **

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®è¿½åŠ 

1. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ** (`cache.rs`)
2. **SQLiteæ¥ç¶šã¨ã‚¹ã‚­ãƒ¼ãƒå®šç¾©**
3. **license.rsã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ã‚’è¿½åŠ **
4. **TTLç®¡ç†**
5. **ãƒ†ã‚¹ãƒˆè¿½åŠ **

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ãƒ“ãƒ«ãƒ‰æˆæœç‰©

```bash
# ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰
target/debug/uv-sbom

# ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
target/release/uv-sbom
```

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

1. **Cargoã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
cargo install --path .
```

2. **ãƒã‚¤ãƒŠãƒªé…å¸ƒ**
```bash
cargo build --release
cp target/release/uv-sbom /usr/local/bin/
```

3. **GitHub Releases** (å°†æ¥)
   - CI/CDã§ãƒ“ãƒ«ãƒ‰
   - ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
   - ãƒã‚¤ãƒŠãƒªã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

## ç›£è¦–ã¨ãƒ­ã‚®ãƒ³ã‚°

### ç¾åœ¨ã®å®Ÿè£…

**æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›** (`eprintln!`):
- é€²æ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**æ¨™æº–å‡ºåŠ›** (`stdout`):
- SBOMå‡ºåŠ›ã®ã¿ (--outputã‚ªãƒ—ã‚·ãƒ§ãƒ³æœªä½¿ç”¨æ™‚)

### å°†æ¥ã®æ‹¡å¼µ

**ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª** (`log`, `env_logger`):
```rust
log::info!("Starting SBOM generation");
log::warn!("License fetch failed for {}", name);
log::error!("Failed to parse lockfile: {}", e);
```

**æ§‹é€ åŒ–ãƒ­ã‚°** (`tracing`):
```rust
tracing::info_span!("fetch_licenses", package_count = packages.len());
```

## ã¾ã¨ã‚

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™:

1. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–**: è²¬å‹™ã®æ˜ç¢ºãªåˆ†é›¢
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: è©³ç´°ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨è§£æ±ºç­–ã®æç¤º
4. **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½ã®è¿½åŠ ãŒå®¹æ˜“
5. **ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨E2Eãƒ†ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ
